# Recognizer-of-road-signs

## Структура проекта

```bash 
Recognizer-of-road-signs
├── .dvc                      # служебная папка DVC
├── configs                   # Конфиги Hydra
│   ├── config.yaml           # Главный конфиг (defaults)
│   ├── data
│   │   └── data.yaml         # Параметры датасета (пути, batch_size и т.д.)
│   ├── model
│   │   └── model.yaml        # Параметры модели (output_dim и пр.)
│   ├── trainer
│   │   └── trainer.yaml      # Параметры обучения (epochs, lr, ckpt_path ...)
│   ├── transforms
│   │   └── transforms.yaml   # Описание аугментаций (train/val/infer)
│   └── mlflow
│       └── mlflow.yaml       # Настройки (server_url, experiment_name, run_name)
├── data
│   ├── data_infer            # Пример изображений для инференса
│   └── data_train            # Папка с dvc-файлами
│       ├── Meta.dvc
│       ├── Test.dvc
│       ├── Train.dvc
│       ├── Meta.csv.dvc
│       ├── Test.csv.dvc
│       └── Train.csv.dvc
├── models           
│   └── gtsrb_model.ckpt.dvc  # Обученная модель
├── sign_recognizer           # Основной код
│   ├── dataset.py            # Класс GTSRB датасета
│   ├── infer.py              # Скрипт для инференса
│   ├── model.py              # CNN-модель
│   ├── test.py               # Скрипт для теста 
│   ├── train.py              # Скрипт для обучения
│   ├── trainer.py            # LightningModule-обёртка
│   └── utils
│       └── transforms_builder.py  # Функция для сборки аугментаций
├── .dvcignore                # Файл, указывающий DVC, какие паттерны игнорировать
├── .gitignore                # Список файлов/папок, не попадающих в Git-репозиторий
├── .pre-commit-config.yaml   # Настройка хуков pre-commit
├── Dockerfile                # Скрипт сборки Docker-образа
├── LICENSE                   
├── README.md                 # Основное проекта
├── commands.py               # CLI: train/test/infer (+ dvc pull) 
├── poetry.lock               # Зафиксированные версии зависимостей
└── pyproject.toml            # Основные зависимости проекта         
 ```

---

## Описание

Проект для классификации дорожных знаков с использованием датасета GTSRB. Включает MLOps-практики: DVC для 
версионирования данных, Hydra для гибкого управления гиперпараметрами, MLflow для логирования экспериментов и 
PyTorch Lightning для удобного обучения.

**Этот проект решает задачу классификации дорожных знаков**:
- Используем датасет GTSRB.
- Обучаем CNN-модель (определённую в model.py) на PyTorch Lightning.
- Управляем гиперпараметрами (epochs, lr, transforms и пр.) через конфиги Hydra.
- Версионируем данные и модели через DVC (Data Version Control).
- Логируем метрики (train/val/test loss, accuracy и т.д.) в MLflow.

---

## Данные 

Основной датасет: GTSRB (German Traffic Sign Recognition Benchmark). [GTSRB](https://www.kaggle.com/datasets/meowmeowmeowmeowmeow/gtsrb-german-traffic-sign)

### Особенности GTSRB

- Содержит 43 класса дорожных знаков (ограничение скорости, приоритет, запреты, указатели и т.д.).
- Изображения собраны в разных условиях освещённости, с разными фонами и ракурсами.
- Количество примеров на класс может отличаться (несбалансированность).

### Проблемы и ограничения

- Разнообразие условий: погода, освещение, угол съёмки могут повлиять на качество классификации.
- Дисбаланс классов: некоторые знаки (например, «Stop») встречаются реже, чем знаки ограничения скорости 50 км/ч.
- Масштаб и шум: на изображениях знаки могут быть маленькими, размытыми.

### Достаточность данных

- GTSRB считается одним из классических датасетов для задач дорожных знаков: он достаточно велик (40k+ изображений) и хорошо подходит для отработки методов компьютерного зрения.
- При тщательном применении аугментаций и правильной разбивке на train/val/test можно получить стабильные результаты, близкие к state-of-the-art.

---

## Подход к моделированию

### Модель

- Используем свёрточную нейронную сеть (CNN) (несколько Conv-блоков + полносвязная часть).
- Библиотеки: PyTorch + PyTorch Lightning.
- Дополнительно настроим аугментации (ColorJitter, RandomFlip, RandomRotation) через torchvision.

#### Итоговая модель
Я реализовал свёрточную нейронную сеть (CNN) со следующей структурой:
1. Вход изображения размера 3×50×50 (RGB, ресайз).
2. Conv + Conv + BatchNorm + ReLU + MaxPool — первый блок свёрточных слоёв (увеличивает каналы с 3 до 64).
3. Conv + Conv + BatchNorm + ReLU + MaxPool — второй блок (64 → 256 каналов).
4. Conv + Conv + BatchNorm + ReLU + MaxPool — третий блок (256 → 1024 каналов).
5. Flatten выходного тензора (размер 1024×6×6) и несколько Fully-Connected слоёв (1024 * 6 * 6 → 512 → 128 → 43), с Dropout (0.3 и 0.2) для регуляризации.

**Выход**: 43 вероятности классов (GTSRB имеет 43 типа знаков).

**Оптимизатор**: Adam, lr=0.0008.

**Число эпох**: по умолчанию 20 (можно менять через конфиг Hydra).

### Управление гиперпараметрами

- Для удобства и гибкости в проекте применяем Hydra: все настройки (epochs, batch_size, пути к данным, архитектура, аугментации) вынесены в YAML-конфиги в папке configs/.

### Версионирование данных

- Используем DVC (Data Version Control). Храним большие файлы датасета за пределами репозитория в S3.

### Логирование

- Применяем MLflow для фиксации метрик (train/val/test loss, accuracy и пр.), а также для сохранения моделей, артефактов (графики, чекпоинты).

### Архитектура (краткая схема)
```css
(Input) -> [Data Augmentations] -> [Conv Blocks + Pooling] -> 
 [Flatten + Dense Layers] -> [Softmax(Output Classes)]
```

---

## Production Pipeline

После обучения модель будет обёрнута в простой пайплайн:
1. Вход: Изображение с камеры или из локального файла.
2. Предобработка: Resize до нужного формата (например, 50x50), нормализация.
3. Инференс: Модель выдаёт вероятности каждого из 43 классов.
4. Постпроцессинг: Выбирается класс с max вероятностью, выводим его как «предсказанный знак».

#### Финальное применение
Планируется добавить интеграцию с веб-сервисом: пользователь (или процесс) отправляет изображение, сервис возвращает класс знака и, возможно, confidence-скор.

### Схема продакшен-пайплайна
```css
[Image] -> [REST API endpoint] -> [Preprocessing + Model inference] -> [Prediction JSON or annotated image]
```

---

## Итог и развитие

1. Получить работающую классификацию дорожных знаков (43 класса) с точностью 95%+.
2. Перейти на детекцию (обнаружение знаков + классификация).
